---
/**
 * Custom Footer component override.
 *
 * Extends Starlight's default Footer to add a "View as Markdown" link
 * that points to the raw Markdown source for the current page.
 * This allows programmatic consumers (LLMs, CLI tools) to fetch
 * Markdown directly by appending .md to any page URL.
 */
import Default from '@astrojs/starlight/components/Footer.astro';

const { entry } = Astro.locals.starlightRoute;

// Build the .md URL from the current page slug.
// entry.id is the file path relative to src/content/docs/ (e.g. "guides/configuration.md")
// We derive the public slug from it and append .md to the URL.
const slug = entry.id
  .replace(/\.mdx?$/, '') // strip extension
  .replace(/\/index$/, ''); // strip trailing /index

const mdUrl = `/${slug}.md`;
---

<Default><slot /></Default>

<div class="view-as-markdown print:hidden">
  <a href={mdUrl}>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="1.2em"
      height="1.2em"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      aria-hidden="true"
    >
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
      <polyline points="14 2 14 8 20 8" />
      <line x1="16" y1="13" x2="8" y2="13" />
      <line x1="16" y1="17" x2="8" y2="17" />
      <polyline points="10 9 9 9 8 9" />
    </svg>
    View as Markdown
  </a>
</div>

<style>
  @layer starlight.components {
    .view-as-markdown {
      display: flex;
      margin-top: 0.5rem;
      font-size: var(--sl-text-sm);
    }

    .view-as-markdown a {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      color: var(--sl-color-gray-3);
    }

    .view-as-markdown a:hover {
      color: var(--sl-color-white);
    }
  }
</style>
